<!DOCTYPE html>
<html>
<head>
  <title>Feigenbaum</title>

  <link rel="stylesheet" type="text/css" href="style.css" />

  <script src="lib/jquery-3.2.1.min.js"></script>
  <script src="lib/math.min.js"></script>
  <script src="lib/d3.min.js"></script>
  <script src="lib/function-plot.min.js"></script>

  <script src="drawPlot.js"></script>
</head>
<body>

  <div>
    <div>Function: </div>
    <select id="sel-func">
      <option value="quadratic">Quadratic Family</option>
      <option value="sin">Sine function</option>
    </select>
    <div>&#956; = <span id="valofmu"></span></div>
    <input id="mu" type="range" min="0" max="400" value="250">
    <br/>
    <div>x<sub>0</sub> = <span id="valofx0"></span></div>
    <input id="x0" type="range" min="0" max="100" value="50">
  </div>

  <div id="functionPlot1"></div>
  <div id="iterationPlot1"></div>
  <div id="feigenbaum"></div>

  <script>
    var funcList = [
      {
        name: "Quadratic family",
        func: function (x, imu) {
          return imu*x*(1-x);
        },
        expr: " * x * (1-x)",
        muRange: [0,4]
      }, {
        name: "Sine",
        func: function (x) {
          return mu * Math.sin(Math.PI * x);
        },
        expr: " * sin(PI * x)",
        muRange: [0,4]
      }
    ];

    var selectedFunction = 0;
    var mu = 2.5;
    var x0 = 0.5;
    var feigenbaum = [];

    function almostEqual(n1, n2) {
      n1 = Math.round(n1 * 10000) / 10000;
      n2 = Math.round(n2 * 10000) / 10000;
      return (n1 == n2);
    }

    function doIteration(func, x0, muValue, breakAtCircle) {
      var result = [];
      for (var i = 0, xi = x0; i <= 200; i++) {
        if (i >= 100) {
          if (breakAtCircle) {
            for (var j = 0; j < result.length; j++) {
              if (almostEqual(xi, result[j][1]))
                return result;
            }
            result.push([muValue, xi]);
          }
          else
            result.push([i,xi]);
        }
        xi = func(xi, muValue);
      }
      return result;
    }

    function calculateFeigenbaum () {
      var result = [];
      for (var imu = 0; imu <= 4; imu = imu + 0.01) {
        var tempArray = doIteration(funcList[selectedFunction].func, 0.5, imu, true);
        result = result.concat(tempArray);
      }
      return result;
    }

    function update() {
      $("#valofmu").text(mu);
      $("#valofx0").text(x0);
      plotMgr.funcPlotWithFixedPoint("#functionPlot1", 300, 300, [0,1],
        mu + funcList[selectedFunction].expr);
      var iterationValues = doIteration(funcList[selectedFunction].func, x0, mu, false);
      plotMgr.pointPlot("#iterationPlot1", 300, 300, [100,200], "iteration step", iterationValues)
    }

    document.getElementById("mu").oninput = function () {
      mu = this.value / 100;
      update();
      plotMgr.pointPlot("#feigenbaum", 600, 300, [0,4], "\u03BC\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0",
        feigenbaum, {annotations: [{
          x: mu,
          text: '\u03BC'
      }]});
    }

    document.getElementById("x0").oninput = function () {
      x0 = this.value / 100;
      update();
    }

    update();

    feigenbaum = calculateFeigenbaum();
    plotMgr.pointPlot("#feigenbaum", 600, 300, [0,4], "\u03BC\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0",
    feigenbaum, {annotations: [{
      x: mu,
      text: '\u03BC'
    }]});
  </script>

</body>
</html>
